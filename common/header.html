<script src="https://unpkg.com/markerjs" data-template-name="modal/labofoz-image-annotator-modal"></script>

 
<script>
  let mark,clicked;

  $('body').on('click', '.d-editor-preview img', function(){
    $('#reply-control').css('height','90vh');
    clicked = true;
    console.log('click?',clicked)
    try{
                    mark.close(function(){
                        console.log("err: close")

                          });
                }
                  catch(e)
                      {
                        console.log(e);
                      }
                    
                  mark = new markerjs.MarkerArea(document.querySelector('.d-editor-preview img'));
                  mark.show((dataUrl) => {
                    $('body').css('position','');
                    // $('#reply-control').css('height','')
                      const res = document.querySelector('.d-editor-preview img');
                      res.src = dataUrl;
                      
                      console.log('clicked check')
                      var $editor = $('#reply-control textarea.d-editor-input').first();
                      console.log('save clicked');
                    
                  }
                  );
                  $(document).ready(function () {
                  $('#svg-sprites').next().addClass('image-annotator-area');
                  $('.markerjs-toolbar').css('position', 'fixed');
                  $('.image-annotator-area').css('position', 'fixed');
                  $('.d-editor-preview img').attr('crossorigin', 'anonymous')
                    }); 
                  $('body').css('position','fixed');

  });
  
  $('body').on('click', '.d-editor-preview img', function showMarkerJs(img, config) { 
    console.log('clicked ')


          $('#reply-control').resize(function(){
            console.log('reply-contorl is resized');
              try{
                    mark.close(function(){
                        console.log("err: close")

                          });
                }
                  catch(e)
                      {
                        console.log(e);
                      }
                    
                  mark = new markerjs.MarkerArea(document.querySelector('.d-editor-preview img'));
                  mark.show((dataUrl) => {
                    $('body').css('position','');
                      const res = document.querySelector('.d-editor-preview img');
                      res.src = dataUrl;
                      console.log('clicked check')
                      var $editor = $('#reply-control textarea.d-editor-input').first();
                      console.log('save clicked');
                  }
                  );
                  $(document).ready(function () {

                    $('#svg-sprites').next().addClass('image-annotator-area');
                    $('.markerjs-toolbar').css('position', 'fixed');
                    $('.image-annotator-area').css('position', 'fixed');
                    $('.d-editor-preview img').attr('crossorigin', 'anonymous')
                    $('body').css('position','fixed');
                  })
                  }) 
                  
            
                  
        
              });
      

</script>